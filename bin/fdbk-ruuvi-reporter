#!/usr/bin/env python3

from fdbk.utils import get_reporter_argparser
from fdbk_ruuvi_reporter.main import add_topic_id, create_topic, start_reporting, read_data_from_db

parser = get_reporter_argparser()
parser.add_argument("--save-topic", nargs=2, type=str, metavar=("MAC", "TOPIC_ID",), help="Save topic id for mac")
parser.add_argument("--create-topic", nargs=2, type=str, metavar=("NAME", "MAC",), help="Create topic for name and mac")
parser.add_argument("--pull-topics", action="store_true", help="Pull topics data from DB")
args = parser.parse_args()

if args.save_topic:
    add_topic_id(*args.save_topic)
elif args.create_topic:
    create_topic(args.db_connection, args.db_parameters, *args.create_topic)
elif args.pull_topics:
    read_data_from_db(args.db_connection, args.db_parameters)
else:
    start_reporting(db_connection=args.db_connection, db_parameters=args.db_parameters, interval=args.interval, num_samples=args.num_samples, verbose=args.verbose)
